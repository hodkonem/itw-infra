# itw-infra

**itw-infra** โ ะธะฝััะฐััััะบัััะฝัะน ัะตะฟะพะทะธัะพัะธะน ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ ะธ ัะตััะธัะพะฒะฐะฝะธั ะผะธะบัะพัะตัะฒะธัะฝะพะน ัะธััะตะผั ัะบะพัะธััะตะผั **ITWizardry**.

ะะตะฟะพะทะธัะพัะธะน ัะพะดะตัะถะธั ะตะดะธะฝัะน `docker-compose.system.yml`, ะบะพัะพััะน ะฟะพะดะฝะธะผะฐะตั **ะฟะพะปะฝัะน dev-ััะตะบ**: ะฑัะพะบะตัั, ะะ ะธ ะฒัะต ะบะปััะตะฒัะต Spring Cloud-ะบะพะผะฟะพะฝะตะฝัั.

ะะฝััะฐััััะบัััะฐ ะฟะพะดะฝะธะผะฐะตััั ะพะดะธะฝ ัะฐะท ะธ ะฟะตัะตะธัะฟะพะปัะทัะตััั ะฒัะตะผะธ ัะตัะฒะธัะฐะผะธ.

---

## ๐ฏ ะฆะตะปั

- ะะฐะทะฒะตัะฝััั ะฒัั ะผะธะบัะพัะตัะฒะธัะฝัั ัะธััะตะผั ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน
- ะัะดะตะปะธัั ะธะฝััะฐััััะบัััั ะพั application-ะบะพะดะฐ
- ะะพะปััะธัั production-like ะพะบััะถะตะฝะธะต ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
- ะฃะฟัะพััะธัั ะธะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั ะธ ะดะตะผะพะฝัััะฐัะธะธ

---

## ๐ฆ ะกะพััะฐะฒ ัะธััะตะผั

| ะะพะผะฟะพะฝะตะฝั | ะะฐะทะฝะฐัะตะฝะธะต |
|---------|------------|
| **PostgreSQL** | ะัะฝะพะฒะฝะฐั ะะ ัะตัะฒะธัะพะฒ |
| **Kafka** | ะัะพะบะตั ัะพะฑััะธะน |
| **ZooKeeper** | ะะพะพัะดะธะฝะฐัะธั Kafka |
| **MailHog** | SMTP-ัะตัะฒะตั + Web UI |
| **Config Server** | External Configuration (Git-backed) |
| **Eureka** | Service Discovery |
| **API Gateway** | Edge-ัะตัะฒะธั, ะผะฐัััััะธะทะฐัะธั + Circuit Breaker |
| **user-service** | ะัะฝะพะฒะฝะพะน ะฑะธะทะฝะตั-ัะตัะฒะธั |
| **notification-service** | ะัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะพะฑััะธะน |

---

## ๐งฉ ะััะธัะตะบัััะฐ

```

```
![image-architecture.png](docs/image-architecture.png)
                โโโโโโโโโโโโโโโโ
                โ  Config Repo โ
                โโโโโโโโฌโโโโโโโโ
                       โ
                โโโโโโโโผโโโโโโโโ
                โ Config Serverโ
                โโโโโโโโฌโโโโโโโโ
                       โ
    โโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโ
    โ                  โ                  โ
```

โโโโโโโโโผโโโโโโโโโ  โโโโโโโโผโโโโโโโโโ  โโโโโโโโผโโโโโโโโโ
โ API Gateway     โ  โ user-service  โ  โ notification- โ
โ (WebFlux + CB)  โ  โ               โ  โ service       โ
โโโโโโโโโฌโโโโโโโโโ  โโโโโโโโฌโโโโโโโโโ  โโโโโโโโฌโโโโโโโโโ
โ                  โ                  โ
โ            PostgreSQL          MailHog (SMTP)
โ
โโโโโโโโโโโ Kafka (user.notifications)

````

ะัะต ัะตัะฒะธัั ัะตะณะธัััะธัััััั ะฒ **Eureka** ะธ ะพะฑะผะตะฝะธะฒะฐัััั ะบะพะฝัะธะณััะฐัะธะตะน ัะตัะตะท **Config Server**.

---

## โ๏ธ ะขัะตะฑะพะฒะฐะฝะธั

- Docker
- Docker Compose v2

---

## ๐ ะัััััะน ััะฐัั

### 1. ะะพะดะณะพัะพะฒะบะฐ ะพะบััะถะตะฝะธั

ะกะพะทะดะฐัั `.env` (ัะฐะนะป ะฝะต ะบะพะผะผะธัะธััั):

```bash
cp .env.example .env
````

ะะธะฝะธะผะฐะปัะฝะพ ะฝะตะพะฑัะพะดะธะผัะต ะฟะตัะตะผะตะฝะฝัะต:

```env
GIT_USERNAME=your_github_username
GIT_TOKEN=your_github_token
```

---

### 2. ะะฐะฟััะบ ัะธััะตะผั

```bash
docker compose -f docker-compose.system.yml up -d --build
```

---

### 3. ะัะพะฒะตัะบะฐ ะบะพะฝัะตะนะฝะตัะพะฒ

```bash
docker compose ps
```

ะัะต ัะตัะฒะธัั ะดะพะปะถะฝั ะฑััั ะฒ ัะพััะพัะฝะธะธ **Up / Healthy**.

---

## ๐ ะะพัััะฟะฝัะต ัะตัะฒะธัั

| ะกะตัะฒะธั        | ะะดัะตั                                          |
| ------------- | ---------------------------------------------- |
| Config Server | [http://localhost:8888](http://localhost:8888) |
| Eureka UI     | [http://localhost:8761](http://localhost:8761) |
| API Gateway   | [http://localhost:8080](http://localhost:8080) |
| MailHog UI    | [http://localhost:8025](http://localhost:8025) |
| PostgreSQL    | localhost:5432                                 |
| Kafka         | localhost:9092                                 |

---

## ๐ ะัะพะฒะตัะบะฐ Config Server

```bash
curl http://localhost:8888/user-service/default
curl http://localhost:8888/notification-service/default
curl http://localhost:8888/api-gateway/default
```

ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั โ JSON ั `propertySources`.

---

## ๐งช ะัะพะฒะตัะบะฐ Eureka

ะัะบัััั ะฒ ะฑัะฐัะทะตัะต:

```
http://localhost:8761
```

ะ ัะฟะธัะบะต ะดะพะปะถะฝั ะฑััั:

* API-GATEWAY
* USER-SERVICE
* NOTIFICATION-SERVICE

ะกัะฐััั: **UP**

---

## ๐ฌ ะัะพะฒะตัะบะฐ ะฐัะธะฝััะพะฝะฝะพะณะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธั

1. ะกะพะทะดะฐัั / ัะดะฐะปะธัั ะฟะพะปัะทะพะฒะฐัะตะปั ัะตัะตะท API Gateway
2. `user-service` ะฟัะฑะปะธะบัะตั ัะพะฑััะธะต ะฒ Kafka
3. `notification-service` ะฟะพะปััะฐะตั ัะพะฑััะธะต
4. ะะธััะผะพ ะพัะพะฑัะฐะถะฐะตััั ะฒ **MailHog UI**

---

## ๐ง ะะฐะถะฝัะต ะดะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ

### Kafka

```properties
spring.kafka.bootstrap-servers=kafka:29092
```

### PostgreSQL

```properties
jdbc:postgresql://itw-postgres:5432/user_service
```

### SMTP (MailHog)

```properties
spring.mail.host=mailhog
spring.mail.port=1025
```

---

## โค๏ธ Healthcheck ZooKeeper

ะ ะพะฑัะฐะทะต `confluentinc/cp-zookeeper` 4LW-ะบะพะผะฐะฝะดั ะผะพะณัั ะฑััั ะพะณัะฐะฝะธัะตะฝั,
ะฟะพััะพะผั healthcheck ัะตะฐะปะธะทะพะฒะฐะฝ ัะตัะตะท ะฟัะพะฒะตัะบั TCP-ะฟะพััะฐ `2181`.

ะญัะพ ััะฐะฑะธะปัะฝัะน ะฒะฐัะธะฐะฝั ะดะปั dev-ััะตะดั.

---

## ๐ ะะตะทะพะฟะฐัะฝะพััั

* GitHub token **ะฝะต ััะฐะฝะธััั ะฒ ัะตะฟะพะทะธัะพัะธะธ**
* ะัะฟะพะปัะทัะตััั `.env`
* ะะตะบะพะผะตะฝะดัะตััั ะฟะตัะธะพะดะธัะตัะบะฐั ัะพัะฐัะธั ัะพะบะตะฝะพะฒ

---

## ๐งช ะกัะตะดะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

ะะพะดัะพะดะธั ะดะปั:

* ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
* ะธะฝัะตะณัะฐัะธะพะฝะฝัั ัะตััะพะฒ
* ะดะตะผะพะฝัััะฐัะธะธ ะฐััะธัะตะบัััั

โ ะะต ะฟัะตะดะฝะฐะทะฝะฐัะตะฝะพ ะดะปั production ะฑะตะท ะดะพัะฐะฑะพัะพะบ.

---

## ๐บ Roadmap

* [ ] Kafka UI
* [ ] Observability (Prometheus + Grafana)
* [ ] Profiles: dev / test
* [ ] CI/CD bootstrap

---

## ๐ค ะะฒัะพั

**Mikhail Latypov**
GitHub: [https://github.com/hodkonem](https://github.com/hodkonem)

```
